---
title: "00_4. R 분석 예제 - 서울의 아파트 가격 분석"
author: "김무성"
date: "2015년 2월 23일"
output:
  html_document:
    keep_md: yes
---


---------------------------

# 목표

* [1]의 예제. 서울의 아파트 평당 가격에 영향을 미치는 변수들을 설정하여 조사한 결과 아래 형태과 같은 자료를 얻었다. 

아파트 평당 가격(P, 단위: 만원)  | 아파트 연령(Y) | 지하철까지의 거리(D, 단위: Km)  | 위치 더미(강남이면 1, 아니면 0)
------------- | ------------  | ------------- | -------------
  1500    | 10  | 1  | 0
  1120    | 2  | 5.5  | 0
  1800    | 3  | 1.2  | 0
  3000    | 39  | 1.5  | 0


-----------------------------

# 분석 
   (1) 아파트 연령(Y), 강남 위치 여부(L), 지하철까지의 거리(D)가 아파트 평당 가격(P)에 미치는 영향을 알아보기 위해 다중회귀모형을 OLS 추정량으로 추정해보라.
   (2) 5% 유의수준을 이용하여 각 계수에 대한 유의성 검정을 수행하여라.
   (3) 잔차와 아파트 평당 가격의 예측값에 대한 산포도를 그려보고, 이분산 존재 여부를 판단해보아라.
   (4) 이 회귀모형에 대한 BPG 검정통계량을 계산하였을 때 10%의 유의수준에서 이분산이 존재한다고 판단할 수 있는가?
   (5) 이 모형에 이분산이 존재한다면 그 이유를 어떻게 설명할 수 있는가?
   (6) White의 이분산-일치 추정량을 이용하여 표준오차를 계산하고 5% 유의수준을 이용하여 각 계수에 대한 유의성 검정을 수행하여라.OLS를 적용하여 계산한 2번의 결과와 어떤 차이가 있는가?
 

----------------------

### 데이터 읽기, 파악, 전처리

 * price : 아파트 평당 가격(P), 단위: 만원
 * year : 아파트 연령(Y)
 * distance : 지하철까지의 거리(D)
 * D : 위치 더미(강남이면 1, 아니면 0)
 
 
```{r}
apt <- read.table('00_data/apt/Apartment.txt', header=T)
head(apt)
str(apt)
summary(apt)
```

----------------

### (1) 아파트 연령(Y), 강남 위치 여부(L), 지하철까지의 거리(D)가 아파트 평당 가격(P)에 미치는 영향을 알아보기 위해 다중회귀모형을 OLS 추정량으로 추정해보라.


```{r}
apt.res <- lm(price ~year+distance+D , data =apt)
summary(apt.res)
```

---------------------------

### (2) 5% 유의수준을 이용하여 각 계수에 대한 유의성 검정을 수행하여라.

각 계수의 t- 검정통계량은 4.921(P-value : 0.0002) , 2.332(P-value : 0.0331), -1.347(P-value : 0.1966) , 4.909(P-value : 0.0000)로 지하철 거리 변수를 제외한 나머지 변수들은 5% 유의수준에서 통계적으로 유의미하다.


---------------------------

### (3) 잔차와 아파트 평당 가격의 예측값에 대한 산포도를 그려보고, 이분산 존재 여부를 판단해보아라.

```{r}
# 잔차 추출
residuals<-resid(apt.res)

# 종속변수의 예측값
yhat <- predict(apt.res, interval ="none")

# 산포도
plot(x=yhat, y=residuals, col="blue", main=expression(list("Scatter Plot of"~e[i]~and~hat(y[i]))))
```

그래프에 의하면 평당 아파트 가격 변수의 예측값이 커질수록 잔차의 분산이 커지는 경향이 나타난다. 이는 회귀모형에 이분산이 존재함을 의미한다.

---------------------------

### (4) 이 회귀모형에 대한 BPG 검정통계량을 계산하였을 때 10%의 유의수준에서 이분산이 존재한다고 판단할 수 있는가?

```{r}
#install.packages("lmtest")
library(lmtest)
bptest(apt.res)
```

BPG 검정통계량은 6.8867이며 계산된 P-value는 0.0756이다. 따라서 10% 유의수준에서 동분산 귀무가설은 기각되어 회귀모형에 이분산이 존재한다고 판단할 수 있다.

---------------------------

### (5) 이 모형에 이분산이 존재한다면 그 이유를 어떻게 설명할 수 있는가?

아파트 연령이 증가할수록 평당 아파트 가격의 변동성이 커지기 때문이다. 즉, 아파트가 오래될수록 가치가 하락하여 평당 아파트 가격이 낮아지지만 아파트가 오래되어 재개발 혹은 재건축이 예정된 아파트는 오히려 평당 아파트 가격이 폭등하는 현상으로 인해 잔차의 분산이 증가하는 이분산이 발생하게 된다.


---------------------------

### (6) White의 이분산-일치 추정량을 이용하여 표준오차를 계산하고 5% 유의수준을 이용하여 각 계수에 대한 유의성 검정을 수행하여라.OLS를 적용하여 계산한 2번의 결과와 어떤 차이가 있는가?


```{r}
#install.packages("sandwich")
library(sandwich)

# beta^의 공분산 행렬
cov.mat <- vcovHC(apt.res, type="HC")
cov.mat

library(lmtest)
# 회귀계수의 유의성 검정
coeftest(apt.res, vcov=cov.mat)
```

화이트의 이분산-일치 추정량을 이용하여 표준오치를 계산한 결과에 의하면 모든 계수에 대한 표준오차가 감소하여 t-검정통계량이 증가하였다. OLS추정 결과에 의해 5% 유의수준에서 통계적으로 유의성이 없었던 지하철 거리 변수도 유의성이 있는 것으로 나타난다.



---------------------------


# 참고문헌
 * [1] 응용 계량경제학 - R 활용 - http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788968660696